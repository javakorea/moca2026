<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<link rel="stylesheet" type="text/css" href="/css/moca.css">
<link rel="stylesheet" type="text/css" href="/css/base.css">
<script language="JavaScript" src="/js/moca/com.js"></script>
<script language="JavaScript" src="/js/moca/grid.js"></script>
<script language="JavaScript" src="/js/data.js"></script>
<script>
async function onMocaLoad() {
    // 모든 moca-frame 탐색
    var frames = document.getElementsByTagName('moca-frame');
    // HTMLCollection은 live라서 뒤에서부터 처리
    for (var i = frames.length - 1; i >= 0; i--) {
        (async function(frame) {
            var src = frame.getAttribute('src');
            if (!src) return;
            
            // 1) 새 div 생성 (moca-frame을 대체)
            var div = com.cloneDiv(frame);
        	let doc = await com.getDocAsync(src);
    		let re = doc.body.innerHTML.replace(/moca-grid/g,'div');
    		doc.body.innerHTML = re;
    		div.innerHTML = doc.body.innerHTML;
    		
    		// 5) 원래 moca-frame 자리에 div로 교체
    	    frame.parentNode.replaceChild(div, frame);
	  		// 2. script 실행
	  		const scripts = doc.querySelectorAll("script");
	  		com.executeScripts(scripts);
	  		// 3. 이제 script 안 함수 사용 가능
	  		if (window.onpageload) {
	  		  window.onpageload();
	  		}
        })(frames[i]);
    }
}
</script>

<body onload="onMocaLoad()">
	<div id="wrap" class="wrap">
		<div id="header" class="header">
			<h3>header</h3>
		</div>
		<div id ="container" class ="container">
			<div id="left" class="left">
				<h3>left</h3>
			</div>
			<div id="right" class="right">
				<moca-frame id='main' type="frame" src="/ui/page001.html"></moca-frame>
			</div>
		</div>
		<div id="footer" class="footer">
			<h3>footer</h3>
		</div>
	</div>
</body>
</html>